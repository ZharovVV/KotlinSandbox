# Канальный уровень

## 3.1. Ключевые вопросы проектирования канального уровня

Канальный уровень использует определенные службы нижележащего физического уровня для отправки и получения битов по
потенциально ненадежным коммуникационным каналам, которые могут терять данные. У него есть ряд специфических функций. К
ним относятся:

1. Обеспечение строго очерченного служебного интерфейса для сетевого уровня.
2. Формирование отдельных фреймов из последовательностей байтов.
3. Обнаружение и исправление ошибок передачи.
4. Управление потоком данных, исключающее "затопление" медленных приемников быстрыми передатчиками.

Для этих целей канальный уровень берет пакеты, полученные с сетевого уровня, и вставляет их в специальные
__фреймы (frames)__, также называемые кадрами, для передачи. В каждом фрейме содержатся поля _Header_ (Заголовок),
_Payload_ (Полезная нагрузка/Пользовательские данные) и _Trailer_ (Трейлер). Структура фрейма показана на илл 3.1.
Управление фреймами - это основная задача канального уровня.

![ill_3_1.png](ill_3_1.png)

> Контроль ошибок, управление потоками и другие функции канального уровня (представленные в этой главе) во многих сетях
> на самом деле являются прерогативой верхних уровней и вообще не относятся к канальному уровню, который выполняет лишь
> простейшие задачи.

### 3.1.1. Службы, предоставляемые сетевому уровню

Задача канального уровня заключается в предоставлении служб сетевому. Основная служба канального уровня заключается в
обмене данными между сетевыми уровнями отправляющего и целевого устройств. На сетевом уровне отправителя находится некая
сущность (назовем её процессом), которая передает пакеты на канальный уровень для их дальнейшей отправки по назначению.
Канальный уровень должен отправить данные адресату так, чтобы они достигли его сетевого уровня, как показано на илл.
3.2 (а). В действительности данные передаются по пути, показанному на илл. 3.2 (б) (Уровень 1 - Физический), однако
проще представить себе два канальных уровня, которые связываются друг с другом с помощью протокола передачи данных.

![ill_3_2.png](ill_3_2.png)

Канальный уровень может предоставлять различные службы. Их набор может отличаться в разных протоколах. Как правило,
встречаются следующие варианты:

1. Служба без подтверждений и без установки соединения (Ethernet).
2. Служба с подтверждениями и без установки соединения (802.11 Wi-Fi).
3. Служба с подтверждениями, ориентированная на установление соединения (самый надежный тип, который подходит для
   длинных ненадежных связей, таких как спутниковый канал или междугороднее телефонное соединение).

### 3.1.2. Формирование фрейма

Для обслуживания сетевого уровня канальный уровень использует службы, предоставляемые ему физическим уровнем. Физический
уровень принимает необработанный поток битов и пытается передать его по назначению. Если канал зашумлен, то на
физическом уровне добавляются избыточные сигналы, чтобы снизить количество ошибок до допустимого уровня. Однако поток
битов, получаемый на уровне передачи данных, не застрахован от ошибок. У некоторых битов могут быть другие значения,
количество принятых битов может быть меньше, равно или больше числа преданных. Канальный уровень должен обнаружить
ошибки и, если нужно, исправить их.

Обычно канальный уровень разделяет поток битов на отдельные фреймы и вычисляет для каждого из них короткий маркер,
называемый контрольной суммой. Контрольная сумма добавляется во фрейм перед тем, как он пересылается дальше. Когда
целевое устройство получает фрейм, контрольная сумма вычисляется заново на его основе. Если она отличается от
содержащейся во фрейме, то канальный уровень понимает, что при передаче произошла ошибка, и принимает меры (например,
игнорирует испорченный фрейм и посылает отправляющему устройству сообщение об ошибке).

Разбиение потока битов на отдельные фреймы представляет собой более сложную задачу, чем это может показаться на первый
взгляд. В книге представлены четыре метода маркировки границ фреймов.

| Метод маркировки границ фрейма                     | Принцип работы | Преимущества | Недостатки |
|----------------------------------------------------|----------------|--------------|------------|
| Подсчет байтов                                     |                |              |            |
| Флаговые байты с байт-стаффингом                   |                |              |            |
| Использование сигнальных битов с бит-стаффингом    |                |              |            |
| Применение запрещенных сигналов физического уровня |                |              |            |

